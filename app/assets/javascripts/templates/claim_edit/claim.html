<ng-form name="claimForm" class="scrollable" ng-controller="ClaimEditClaimController">
  <div class="scrollable-content section">
    <div class="panel" id="claim">
      <div class="panel-body">
        <div class="form-group row">
          <label for="photo-file" class="control-label col-xs-12">Patient photo</label>
          <a href="{{photo.url}}" class="form-control-wrapper col-xs-12" ng-if="photo" target="photo-preview" toggle>
            <img ng-src="{{photo.small_url}}" width="300" class="thumbnail">
          </a>
          <div class="form-control-wrapper col-xs-12">
            <span class="btn btn-primary btn-lg" disabled="disabled" ng-show="uploading">
              <i class="fa fa-spinner fa-spin"></i> Uploadingâ€¦
            </span>
            <span class="btn btn-primary btn-lg fileinput-button" ng-hide="uploading">
              <i class="fa fa-camera"></i> Upload
              <input type="file" mb-upload="file" id="photo-file" accept="image/*;capture=camera">
            </span>
          </div>
        </div>

        <div class="form-group row" ng-class="{'has-error': (claimForm.patient_name.$dirty || submitted) && claimForm.patient_name.$invalid}">
          <label for="claim-patient-name" class="control-label col-xs-12">Patient name</label>
          <div class="form-control-wrapper col-xs-12">
            <input type="text" name="patient_name" ng-model="claim.patient_name" class="form-control input-lg" id="claim-patient-name" mb-scroll-into-view required>
            <div ng-messages="claimForm.patient_name.$error" ng-show="submitted">
              <p class="help-block" ng-message="required">is missing</p>
            </div>
          </div>
        </div>

        <div class="form-group row" ng-class="{'has-error': (claimForm.hospital.$dirty || submitted) && claimForm.hospital.$invalid}">
          <label for="claim-hospital" class="control-label col-xs-12">Hospital</label>
          <div class="form-control-wrapper col-xs-12">
            <input type="text" name="hospital" ng-model="claim.hospital" class="form-control input-lg" id="claim-hospital" datasets="hospitals" sf-typeahead mb-typeahead required mb-scroll-into-view>
            <div ng-messages="claimForm.hospital.$error" ng-show="submitted">
              <p class="help-block" ng-message="required">is missing</p>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="claim-referring-physician" class="control-label col-xs-12">Referring physician</label>
          <div class="form-control-wrapper col-xs-12">
            <input type="text" name="referring_physician" ng-model="claim.referring_physician" class="form-control input-lg" id="claim-referring-physician" mb-scroll-into-view>
          </div>
        </div>

        <div class="row">
          <label class="control-label col-xs-12" for="claim-diagnoses-0-name">Diagnoses</label>
          <ng-form class="col-xs-12" name="diagnosisForm" ng-repeat="diagnosis in claim.diagnoses">
            <div class="form-group row" ng-class="{'has-error': (diagnosisForm.name.$dirty || submitted) && diagnosisForm.name.$invalid}">
              <div class="form-control-wrapper col-xs-8 col-sm-10 col-md-11">
                <input id="claim-diagnoses-{{$index}}-name" type="text" name="name" ng-model="diagnosis.name" class="form-control input-lg" datasets="diagnoses" sf-typeahead mb-typeahead required mb-scroll-into-view>
                <div ng-messages="diagnosisForm.name.$error" ng-show="submitted">
                  <p class="help-block" ng-message="required">is missing</p>
                </div>
              </div>
              <div class="col-xs-4 col-sm-2 col-md-1">
                <button type="button" class="btn btn-lg btn-danger btn-block" ng-click="remove(diagnosis)" ng-disabled="claim.diagnoses.length <= 1">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>
          </ng-form>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <button type="button" class="btn btn-lg btn-success btn-block" ng-click="add()"><i class="fa fa-plus"></i> Add a new diagnosis</button>
          </div>
        </div>

        <div ng-if="!isSimplifiedTemplate()">
          <div class="form-group row">
            <label class="control-label col-xs-12">Most responsible physician</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-switch ng-model="claim.most_responsible_physician" id="claim-most-responsible-physician"></mb-switch>
            </div>
          </div>

          <div class="form-group row" ng-class="{'has-error': (claimForm.admission_on.$dirty || submitted) && claimForm.admission_on.$invalid}">
            <label class="control-label col-xs-12" for="claim-admission-on">Admission date</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-date name="admission_on" ng-model="claim.admission_on" class="form-control input-lg" id="claim-admission-on" max="{{claim.last_seen_on}}" placeholder="Select date" required></mb-date>
              <div ng-messages="claimForm.admission_on.$error" ng-show="submitted">
                <p class="help-block" ng-message="required">is missing</p>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <label class="control-label col-xs-12">First seen date is admission</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-switch ng-model="claim.first_seen_on_admission" id="is-first-seen-on-hidden"></mb-switch>
            </div>
          </div>

          <div class="form-group row" ng-class="{'has-error': (claimForm.first_seen_on.$dirty || submitted) && claimForm.first_seen_on.$invalid}" ng-hide="claim.first_seen_on_admission">
            <label for="claim-first-seen-on" class="control-label col-xs-12">First seen date</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-date name="first_seen_on" ng-model="claim.first_seen_on" class="form-control input-lg" id="claim-first-seen-on" min="{{claim.admission_on}}" max="{{claim.last_seen_on}}" placeholder="Select date" required></mb-date>
              <div ng-messages="claimForm.first_seen_on.$error" ng-show="submitted">
                <p class="help-block" ng-message="required">is missing</p>
                <p class="help-block" ng-message="min">must be after admission</p>
                <p class="help-block" ng-message="max">must be before last seen</p>
              </div>
            </div>
          </div>

          <div class="form-group row" ng-if="isFirstSeenConsultVisible()">
            <label class="control-label col-xs-12">Consult on first seen date</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-switch ng-model="claim.first_seen_consult" id="claim-first-seen-consult"></mb-switch>
            </div>
          </div>

          <div class="form-group row" ng-if="isICUTransferVisible()">
            <label class="control-label col-xs-12">Transfer from ICU/CCU</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-switch ng-model="claim.icu_transfer" id="claim-icu-transfer"></mb-switch>
            </div>
          </div>

          <div class="form-group row" ng-class="{'has-error': (claimForm.last_seen_on.$dirty || submitted) && claimForm.last_seen_on.$invalid}">
            <label for="claim-last-seen-on" class="control-label col-xs-12">Last seen date</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-date name="last_seen_on" ng-model="claim.last_seen_on" class="form-control input-lg" id="claim-last-seen-on" min="{{claim.first_seen_on}}" placeholder="Select date" required></mb-date>
              <div ng-messages="claimForm.last_seen_on.$error" ng-show="submitted">
                <p class="help-block" ng-message="required">is missing</p>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <label class="control-label col-xs-12">Last seen date is discharge</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-switch ng-model="claim.last_seen_discharge" id="claim-last-seen-discharge"></mb-switch>
            </div>
          </div>
        </div>

        <div ng-if="isSimplifiedTemplate()">
          <div class="form-group row" ng-class="{'has-error': (claimForm.procedure_on.$dirty || submitted) && claimForm.procedure_on.$invalid}">
            <label class="control-label col-xs-12" for="claim-procedure-on">Procedure / treatment date</label>
            <div class="form-control-wrapper col-xs-12">
              <mb-date name="procedure_on" ng-model="claim.procedure_on" class="form-control input-lg" id="claim-procedure-on" placeholder="Select date" required></mb-date>
              <div ng-messages="claimForm.procedure_on.$error" ng-show="submitted">
                <p class="help-block" ng-message="required">is missing</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</ng-form>
